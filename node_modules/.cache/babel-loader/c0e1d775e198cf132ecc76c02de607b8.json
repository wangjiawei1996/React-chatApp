{"ast":null,"code":"import _objectWithoutProperties from \"/Users/wangjiawei/Desktop/react-chat/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _objectSpread from \"/Users/wangjiawei/Desktop/react-chat/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport axios from 'axios';\nimport { getRedirectPath } from '../util';\nvar AUTH_SUCCESS = 'AUTH_SUCCESS';\nvar ERROR_MSG = 'ERROR_MSG';\nvar LOAD_DATA = 'LOAD_DATA';\nvar initState = {\n  redirectTo: '',\n  msg: '',\n  user: '',\n  type: '' // reducer\n\n};\nexport function user() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case AUTH_SUCCESS:\n      return _objectSpread({}, state, {\n        msg: '',\n        redirectTo: getRedirectPath(action.payload)\n      }, action.payload);\n\n    case LOAD_DATA:\n      return _objectSpread({}, state, action.payload);\n\n    case ERROR_MSG:\n      return _objectSpread({}, state, {\n        isAuth: false,\n        msg: action.msg\n      });\n\n    default:\n      return state;\n  }\n}\n\nfunction authSuccess(obj) {\n  var pwd = obj.pwd,\n      data = _objectWithoutProperties(obj, [\"pwd\"]);\n\n  return {\n    type: AUTH_SUCCESS,\n    payload: data\n  };\n}\n\nfunction errorMsg(msg) {\n  return {\n    msg: msg,\n    type: ERROR_MSG\n  };\n}\n\nexport function loadData(userinfo) {\n  return {\n    type: LOAD_DATA,\n    payload: userinfo\n  };\n}\nexport function update(data) {\n  return function (dispatch) {\n    axios.post('/user/update', data).then(function (res) {\n      if (res.status === 200 && res.data.code === 0) {\n        dispatch(authSuccess(res.data.data));\n      } else {\n        dispatch(errorMsg(res.data.msg));\n      }\n    });\n  };\n}\nexport function login(_ref) {\n  var user = _ref.user,\n      pwd = _ref.pwd;\n\n  if (!user || !pwd) {\n    return errorMsg('用户密码必须输入');\n  }\n\n  return function (dispatch) {\n    axios.post('/user/login', {\n      user: user,\n      pwd: pwd\n    }).then(function (res) {\n      if (res.status === 200 && res.data.code === 0) {\n        dispatch(authSuccess(res.data.data));\n      } else {\n        dispatch(errorMsg(res.data.msg));\n      }\n    });\n  };\n}\nexport function register(_ref2) {\n  var user = _ref2.user,\n      pwd = _ref2.pwd,\n      repeatpwd = _ref2.repeatpwd,\n      type = _ref2.type;\n\n  if (!user || !pwd || !type) {\n    return errorMsg('用户名密码必须输入');\n  }\n\n  if (pwd !== repeatpwd) {\n    return errorMsg('密码和确认密码不同');\n  }\n\n  return function (dispatch) {\n    axios.post('/user/register', {\n      user: user,\n      pwd: pwd,\n      type: type\n    }).then(function (res) {\n      if (res.status === 200 && res.data.code === 0) {\n        dispatch(authSuccess({\n          user: user,\n          pwd: pwd,\n          type: type\n        }));\n      } else {\n        dispatch(errorMsg(res.data.msg));\n      }\n    });\n  };\n}","map":{"version":3,"sources":["/Users/wangjiawei/Desktop/react-chat/src/redux/user.redux.js"],"names":["axios","getRedirectPath","AUTH_SUCCESS","ERROR_MSG","LOAD_DATA","initState","redirectTo","msg","user","type","state","action","payload","isAuth","authSuccess","obj","pwd","data","errorMsg","loadData","userinfo","update","dispatch","post","then","res","status","code","login","register","repeatpwd"],"mappings":"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","sourcesContent":["\nimport axios from 'axios'\nimport {getRedirectPath} from '../util'\n\nconst AUTH_SUCCESS = 'AUTH_SUCCESS'\nconst ERROR_MSG = 'ERROR_MSG'\nconst LOAD_DATA = 'LOAD_DATA'\nconst initState={\n\tredirectTo:'',\n\tmsg:'',\n\tuser:'',\n\ttype:''\n}\n// reducer\nexport function user(state=initState, action){\n\tswitch(action.type){\n\t\tcase AUTH_SUCCESS:\n\t\t\treturn {...state, msg:'',redirectTo:getRedirectPath(action.payload),...action.payload}\n\t\tcase LOAD_DATA:\n\t\t\treturn {...state, ...action.payload}\n\t\tcase ERROR_MSG:\n\t\t\treturn {...state, isAuth:false, msg:action.msg}\n\t\tdefault:\n\t\t\treturn state\n\t}\n} \n\nfunction authSuccess(obj){\n\tconst {pwd,...data} = obj\n\treturn {type: AUTH_SUCCESS, payload:data}\n}\n\nfunction errorMsg(msg){\n\treturn { msg, type:ERROR_MSG }\n}\n\nexport function loadData(userinfo){\n\treturn { type:LOAD_DATA, payload:userinfo}\n}\n\nexport function update(data){\n\treturn dispatch=>{\n\t\taxios.post('/user/update',data)\n\t\t\t.then(res=>{\n\t\t\t\tif (res.status===200&&res.data.code===0) {\n\t\t\t\t\tdispatch(authSuccess(res.data.data))\n\t\t\t\t}else{\n\t\t\t\t\tdispatch(errorMsg(res.data.msg))\n\t\t\t\t}\n\t\t\t})\n\t}\n}\nexport function login({user,pwd}){\n\tif (!user||!pwd) {\n\t\treturn errorMsg('用户密码必须输入')\n\t}\n\treturn dispatch=>{\n\t\taxios.post('/user/login',{user,pwd})\n\t\t\t.then(res=>{\n\t\t\t\tif (res.status===200&&res.data.code===0) {\n\t\t\t\t\tdispatch(authSuccess(res.data.data))\n\t\t\t\t}else{\n\t\t\t\t\tdispatch(errorMsg(res.data.msg))\n\t\t\t\t}\n\t\t\t})\t\t\n\t}\n\n\n}\n\nexport function register({user,pwd,repeatpwd,type}){\n\tif (!user||!pwd||!type) {\n\t\treturn errorMsg('用户名密码必须输入')\n\t}\n\tif (pwd!==repeatpwd) {\n\t\treturn errorMsg('密码和确认密码不同')\n\t}\n\treturn dispatch=>{\n\t\taxios.post('/user/register',{user,pwd,type})\n\t\t\t.then(res=>{\n\t\t\t\tif (res.status===200&&res.data.code===0) {\n\t\t\t\t\tdispatch(authSuccess({user,pwd,type}))\n\t\t\t\t}else{\n\t\t\t\t\tdispatch(errorMsg(res.data.msg))\n\t\t\t\t}\n\t\t\t})\t\t\n\t}\n\n}\n\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}